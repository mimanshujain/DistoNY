<!DOCTYPE html>
<!--[if IE 9]> <html lang="en" class="ie9"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en">
<!--<![endif]-->
	<head>
		<meta charset="utf-8">
	    <meta property="og:image" content="placeholder.png">		
		<title>DistoNY</title>
		<meta name="description" content="Worthy a Bootstrap-based, Responsive HTML5 Template">
		<meta name="author" content="htmlcoder.me">

		<!-- Mobile Meta -->
		<meta name="viewport" content="width=device-width, initial-scale=1.0">

		<!-- Favicon -->
		<link rel="shortcut icon" href="images/favicon.ico">

		<!-- Web Fonts -->
		<link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,400,700,300&amp;subset=latin,latin-ext' rel='stylesheet' type='text/css'>
		<link href='http://fonts.googleapis.com/css?family=Raleway:700,400,300' rel='stylesheet' type='text/css'>

		<!-- Bootstrap core CSS -->
		<link href="bootstrap/css/bootstrap.css" rel="stylesheet">

		<!-- Font Awesome CSS -->
		<link href="fonts/font-awesome/css/font-awesome.css" rel="stylesheet">

		<!-- Plugins -->
		<link href="css/animations.css" rel="stylesheet">

		<!-- Worthy core CSS file -->
		<link href="css/style.css" rel="stylesheet">

		<!-- Custom css --> 
		<link href="css/custom.css" rel="stylesheet">
	  	<script src="d3.v3.js"></script>	
	    <!-- <script src="http://d3js.org/d3.v3.min.js"></script>-->
	    <script src="lib/colorbrewer.js"></script>
	    <script src="lib/topojson.js"></script>
	    <script src="cartogram.js"></script>	  	
  <script src="dragit.js"></script>
	</head>
<style>

#chart {
  height: 506px;
}

text {
  font-size: 15px;
}

.dot {
  stroke: #000;
}

.axis path, .axis line {
  fill: #000000;
  stroke: #000;
  shape-rendering: crispEdges;
}

.label {
  fill: #777;
}

.year.label {
  font: 500 100px "Helvetica Neue";
  fill: #ddd;
}

.country.label  {
  font: 500 96px "Helvetica Neue";
  fill: #ddd;
}

.year.label.active {
  fill: #aaa;
}

circle.pointTrajectory {
   pointer-events: none;
   stroke: lightgray;
   fill: black;
   opacity: 0;
}

path.lineTrajectory {
  stroke-width: 2;
  stroke-opacity: .5;
  stroke: white;
  fill: none;
  pointer-events: none;
}

.selected {
  stroke-width: 4;
}

#container {
width: 800px;
margin: 20px auto;
}
/*Distor*/
form, form > * {
margin: 0;
}

#status {
color: #999;
}

#map-container {
height: 500px;
text-align: center;
position: relative;
margin: 20px 0;
}

#map {
display: block;
position: absolute;
background: #fff;
margin: 0;
}

path.state {
stroke: #666;
/*stroke-width: .05;*/
}

path.state:hover {
stroke: #000;
}

form {
font-size: 120%;
}

select {
font-size: inherit;
}

#placeholder {
position: absolute;
z-index: -1;
display: block;
left: 0;
top: 0;
}

.subunit-label {
fill: #777;
fill-opacity: .5;
font-size: 20px;
font-weight: 300;
text-anchor: middle;
}

</style>
	<body class="no-trans">
		<!-- scrollToTop -->
		<!-- ================ -->
		<div class="scrollToTop"><i class="icon-up-open-big"></i></div>

		<!-- header start -->
		<!-- ================ --> 
		<header class="header fixed clearfix navbar navbar-fixed-top">
			<div class="container">
				<div class="row">
					<div class="col-md-4">

						<!-- header-left start -->
						<!-- ================ -->
						<div class="header-left clearfix">

							<!-- logo -->
							<div class="logo smooth-scroll">
								<!-- <a href="#banner"><img id="logo" src="images/logo.png" alt="Worthy"></a> -->
							</div>

							<!-- name-and-slogan -->
							<div class="site-name-and-slogan smooth-scroll">
								<div class="site-name"><a href="#banner">DistoNY</a></div>
								<!-- <div class="site-slogan">Free Bootstrap Theme by <a target="_blank" href="http://htmlcoder.me">HtmlCoder</a></div> -->
							</div>

						</div>
						<!-- header-left end -->

					</div>
					<div class="col-md-8">

						<!-- header-right start -->
						<!-- ================ -->
						<div class="header-right clearfix">

							<!-- main-navigation start -->
							<!-- ================ -->
							<div class="main-navigation animated">

								<!-- navbar start -->
								<!-- ================ -->
								<nav class="navbar navbar-default" role="navigation">
									<div class="container-fluid">

										<!-- Toggle get grouped for better mobile display -->
										<div class="navbar-header">
											<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse-1">
												<span class="sr-only">Toggle navigation</span>
												<span class="icon-bar"></span>
												<span class="icon-bar"></span>
												<span class="icon-bar"></span>
											</button>
										</div>

										<!-- Collect the nav links, forms, and other content for toggling -->
										<div class="collapse navbar-collapse scrollspy smooth-scroll" id="navbar-collapse-1">
											<ul class="nav navbar-nav navbar-right">
												<li class="active"><a href="#banner">Home</a></li>
												<li><a href="#about">About</a></li>
												<li><a href="#services">Visualization</a></li>
											 	<li><a href="#portfolio">Dynamic Map</a></li>
												<li><a href="#contact">Contact</a></li> 
											</ul>
										</div>

									</div>
								</nav>
								<!-- navbar end -->

							</div>
							<!-- main-navigation end -->

						</div>
						<!-- header-right end -->

					</div>
				</div>
			</div>
		</header>
		<!-- header end -->

		<!-- banner start -->
		<!-- ================ -->
		<div id="banner" class="banner">
			<div class="banner-image"></div>
			<div class="banner-caption">
				<div class="container">
					<div class="row">
						<div class="col-md-8 col-md-offset-2 object-non-visible" data-animation-effect="fadeIn">
							<h1 class="text-center">We are <span>DistoNY</span></h1>
							<b><p class="lead text-center">Interactive data visualization goes a step further â€“ moving beyond the display of static graphics and spreadsheets to using computers and mobile devices to drill down into charts and graphs for more details.  We are making it more INTUITIVE.</p></b>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!-- banner end -->

		<!-- section start -->
		<!-- ================ -->
		<div class="section clearfix object-non-visible" data-animation-effect="fadeIn">
			<div class="container">
				<div class="row">
					<div class="col-md-12">
						<h1 id="about" class="title text-center">About <span>DistoNY</span></h1>
						<p class="lead text-center">We are represting data in a more Intuitive manner by distorting the map based on the values measured on the scale of various parameters.</p>
						<div class="space"></div>
						<div class="row">
			<!-- 				<div class="col-md-6">
								<img src="images/section-image-1.png" alt="">
								<div class="space"></div>
							</div>
							<div class="col-md-6">
								<ul class="list-unstyled">
									<li><i class="fa fa-caret-right pr-10 text-colored"></i> Lorem ipsum dolor sit amet</li>
									<li><i class="fa fa-caret-right pr-10 text-colored"></i> Reiciendis deleniti neque aliquid</li>
									<li><i class="fa fa-caret-right pr-10 text-colored"></i> Ipsam fuga error commodi</li>
									<li><i class="fa fa-caret-right pr-10 text-colored"></i> Lorem ipsum dolor sit amet</li>
									<li><i class="fa fa-caret-right pr-10 text-colored"></i> Dignissimos molestiae necessitatibus</li>
								</ul>
							</div> -->
						</div>
						<div class="space"></div>
						<!-- <h2>Becessitatibus quae beatae possimus ullam</h2> -->
						<div class="row">
							<div class="col-md-6">
							</div>
							<div class="col-md-6">
								<div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!-- section end -->

		<!-- section start -->
		<!-- ================ -->
		<div class="section translucent-bg black">
			<div class="container object-non-visible" data-animation-effect="fadeIn">
				<h1 id="services"  class="text-center title">A Visualization New York State Data</h1>
        <div id = "x_axis">
        <div class="dropdown">
          <button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown">Select X Axis
          <span class="caret"></span></button>
          <ul class="dropdown-menu">
            <li><a href="#" id="poverty1">Poverty</a></li>
            <li><a href="#" id="health">Health</a></li>
            <li><a href="#" id="crime">Crime</a></li>
            <li><a href="#" id="education">Education</a></li>
            <li><a href="#" id="banking">Banking</a></li>
          </ul>
        </div>  
        </div>   
        <br>
        <div id = "y_axis">
        <div class="dropdown">
          <button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown">Select Y Axis
          <span class="caret"></span></button>
          <ul class="dropdown-menu">
            <li><a href="#" id="poverty">Poverty</a></li>
            <li><a href="#" id="health">Health</a></li>
            <li><a href="#" id="crime">Crime</a></li>
            <li><a href="#" id="education">Education</a></li>
            <li><a href="#" id="banking">Banking</a></li>
          </ul>
        </div>  
        </div> 
        <br>
        <div id = "circle">
        <div class="dropdown">
          <button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown">Select Circle
          <span class="caret"></span></button>
          <ul class="dropdown-menu">
            <li><a href="#" id="poverty">Poverty</a></li>
            <li><a href="#" id="health">Health</a></li>
            <li><a href="#" id="crime">Crime</a></li>
            <li><a href="#" id="education">Education</a></li>
            <li><a href="#" id="banking">Banking</a></li>
          </ul>
        </div>  
        </div> 
				<div class="space"></div>
				<div class="row" align="center">
<!-- 					<div class="col-sm-6">
						
					</div>
					<div class="space visible-xs"></div>
					<div class="col-sm-6">
						
					</div> -->
					<div id="chart" style="margin:0px"></div> 
					<span id="min-time">1980</span> 
					<input type="range" name="points" min="0" max="30" step="1" value="0" id="slider-time" style="width:1400px">
					<span id="max-time">2008</span>					
				</div>
			</div>
		</div>
		<!-- section end -->
		<!-- section start -->
		<!-- ================ -->		
		<div class="section">
			<div class="container">
				<h1 class="text-center title" id="portfolio">Distorted Map</h1>
				<div class="separator"></div>
				<input type="button" id="btn1" class="btn" style="padding-right: 2cm;" value = "New York" onclick="loadData('ny')">                                               
				<input type="button" id="btn1" class="btn" value="Erie County" onclick="loadData('erie')">
			
				<br>	
				  <div style="margin-left: 50px;">
				    <div style="width: 350px; float: left;">
				      <div id="container">
				          <form>
				            <p>
				              <table id="field"></table>
				              <label style = "visibility:hidden"><select id="year"></select></label>
				              <span id="status"></span>
				            </p>
				          </form>
				      </div>
				    </div>
				    <div style="margin-left: 300px;">
				        <div id="mapc"></div>
				        <div id="top" style="margin-left:600px; margin-top:50px">
				          <table id="toptable"></table>
				        </div>
				    </div>
				  </div> 				
			</div>
		</div>
		<!-- section end -->
<!-- ================ -->
		<!-- <br><br><br>
		<div class="section">
			<div class="container">
				<h1 class="text-center title" id="clients">Erie Distorted Map</h1>
				<div class="separator"></div>
				<br>	
				  <div style="margin-left: 120px;">
				    <div style="width: 320px; float: left;">
				      <div id="container">
				          <form>
				            <p>
				              <table id="field_erie"></table>
				              <label style = "visibility:hidden"><select id="year"></select></label>
				              <span id="status"></span>
				            </p>
				          </form>
				      </div>
				    </div>
				    <div style="margin-left: 220px;">
				        <div id="mapc_erie"></div>
				        <div id="top_erie" style="margin-left:600px; margin-top:50px">
				          <table id="toptable_erie"></table>
				        </div>
				    </div>
				  </div> 				
			</div>
		</div> -->
		<!-- section end -->		


		
		<!-- section end -->

		<!-- footer start -->
		<!-- ================ -->
		<br><br><br><br><br>
		<footer id="footer">

			<!-- .footer start -->
			<!-- ================ -->
			<div class="footer section">
				<div class="container" style="padding-top:50px;">
					<h1 class="title text-center" id="contact">Contact Us</h1>
					<div class="space"></div>
					<div class="row">
						<div class="col-sm-6">
							<div class="footer-content">
								<p class="large">We are Graduate Student of University at Buffalo</p>
								<ul class="list-icons">
									<li><i class="fa fa-map-marker pr-10"></i> SUNY UB</li>
									<li><i class="fa fa-phone pr-10"></i> +00 1234567890</li>
									<li><i class="fa fa-fax pr-10"></i> +00 1234567891 </li>
									<li><i class="fa fa-envelope-o pr-10"></i>mimanshu@buffalo.edu</li>
								</ul>
								<ul class="social-links">
									<li class="facebook"><a target="_blank" href="https://www.facebook.com/pages/HtmlCoder/714570988650168"><i class="fa fa-facebook"></i></a></li>
									<li class="twitter"><a target="_blank" href="https://twitter.com/HtmlcoderMe"><i class="fa fa-twitter"></i></a></li>
									<li class="googleplus"><a target="_blank" href="http://plus.google.com"><i class="fa fa-google-plus"></i></a></li>
									<li class="skype"><a target="_blank" href="http://www.skype.com"><i class="fa fa-skype"></i></a></li>
									<li class="linkedin"><a target="_blank" href="http://www.linkedin.com"><i class="fa fa-linkedin"></i></a></li>
									<li class="youtube"><a target="_blank" href="http://www.youtube.com"><i class="fa fa-youtube"></i></a></li>
									<li class="flickr"><a target="_blank" href="http://www.flickr.com"><i class="fa fa-flickr"></i></a></li>
									<li class="pinterest"><a target="_blank" href="http://www.pinterest.com"><i class="fa fa-pinterest"></i></a></li>
								</ul>
							</div>
						</div>
						<div class="col-sm-6">
							<div class="footer-content">
								<form role="form" id="footer-form">
									<div class="form-group has-feedback">
										<label class="sr-only" for="name2">Name</label>
										<input type="text" class="form-control" id="name2" placeholder="Name" name="name2" required>
										<i class="fa fa-user form-control-feedback"></i>
									</div>
									<div class="form-group has-feedback">
										<label class="sr-only" for="email2">Email address</label>
										<input type="email" class="form-control" id="email2" placeholder="Enter email" name="email2" required>
										<i class="fa fa-envelope form-control-feedback"></i>
									</div>
									<div class="form-group has-feedback">
										<label class="sr-only" for="message2">Message</label>
										<textarea class="form-control" rows="8" id="message2" placeholder="Message" name="message2" required></textarea>
										<i class="fa fa-pencil form-control-feedback"></i>
									</div>
									<input type="submit" value="Send" class="btn btn-default">
								</form>
							</div>
						</div>
					</div>
				</div>
			</div>
			<!-- .footer end -->

			<!-- .subfooter start -->
			<!-- ================ -->
			<div class="subfooter">
				<div class="container">
					<div class="row">
						<div class="col-md-12">
							<p class="text-center">Copyright Â© 2015 DistoNY <a target="_blank" href="http://htmlcoder.me">HtmlCoder</a>.</p>
						</div>
					</div>
				</div>
			</div>
			<!-- .subfooter end -->

		</footer>
		<!-- footer end -->

		<!-- JavaScript files placed at the end of the document so the pages load faster
		================================================== -->
		<!-- Jquery and Bootstap core js files -->
		<script type="text/javascript" src="plugins/jquery.min.js"></script>
		<script type="text/javascript" src="bootstrap/js/bootstrap.min.js"></script>

		<!-- Modernizr javascript -->
		<script type="text/javascript" src="plugins/modernizr.js"></script>

		<!-- Isotope javascript -->
		<script type="text/javascript" src="plugins/isotope/isotope.pkgd.min.js"></script>
		
		<!-- Backstretch javascript -->
		<script type="text/javascript" src="plugins/jquery.backstretch.min.js"></script>

		<!-- Appear javascript -->
		<script type="text/javascript" src="plugins/jquery.appear.js"></script>

		<!-- Initialization of Plugins -->
		<script type="text/javascript" src="js/template.js"></script>

		<!-- Custom Scripts -->
		<script type="text/javascript" src="js/custom.js"></script>
<script>
document.getElementById("y_axis").style.display = 'none';
document.getElementById("circle").style.display = 'none';
$('#poverty1').click(function(e) {
    //alert('alerted');
    document.getElementById("y_axis").style.display = 'block';
    e.preventDefault();// prevent the default anchor functionality
});
$('#poverty1').click(function(e) {
    //alert('alerted');
    document.getElementById("y_axis").style.display = 'block';
    e.preventDefault();// prevent the default anchor functionality
});
// alert("Hi");
loadVisual("education", "poverty", "health");
// loadVisual();
function loadVisual(x_val, y_val, cir_val){
  // function loadVisual(){
  // alert("Hi "+x_val+" "+ y_val+" "+cir_val);
 // alert("Hi");
  // Various accessors that specify the four dimensions of data to visualize.
function x(d) { //alert("Hi1");
  return selection(x_val, d);
 // return d.income; 
 // return d.education; 
}
function y(d) { //alert("Hi2");
  return selection(y_val, d);
  // return d.poverty; 
  // return d.lifeExpectancy; 
}
function radius(d) { //alert("Hi3");
    return selection(cir_val, d);
  // return d.health; 
  // return d.population; 
}
function color(d) { return d.region; }
function key(d) { return d.name; }

function selection(axisValue, d){
  if(axisValue=="education") return d.education;
  if(axisValue=="poverty") return d.poverty;
  if(axisValue=="health") return d.health;
  if(axisValue=="crime") return d.crime;
  if(axisValue=="banking") return d.banking;
}

// Chart dimensions.
var margin = {top: 9.5, right: 49.5, bottom: 29.5, left: 59.5},
    width = 1360 - margin.right,
    height = 500 - margin.top - margin.bottom;

// Various scales. These domains make assumptions of data, naturally.
var xScale = d3.scale.log().domain([200, 1e6+500]).range([0, width]),//[200, 1e6+500]
    yScale = d3.scale.linear().domain([1, 120]).range([height, 0]),
    radiusScale = d3.scale.sqrt().domain([0, 5e8]).range([0, 70]),
    colorScale = d3.scale.category10();

// The x & y axes.
var xAxis = d3.svg.axis().orient("bottom").scale(xScale).ticks(12, d3.format(",d")),
    yAxis = d3.svg.axis().scale(yScale).orient("left");

// Create the SVG container and set the origin.
var svg = d3.select("#chart").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
    .attr("class", "gRoot")

// Add the x-axis.
svg.append("g")
    .attr("class", "x axis")
    .attr("transform", "translate(0," + height + ")")
    .call(xAxis);

// Add the y-axis.
svg.append("g")
    .attr("class", "y axis")
    .call(yAxis);

// Add an x-axis label.
svg.append("text")
    .attr("class", "x label")
    .attr("text-anchor", "end")
    .attr("x", width)
    .attr("y", height - 6)
    .text("Education Expenditures, inflation-adjusted (dollars)");

// Add a y-axis label.
svg.append("text")
    .attr("class", "y label")
    .attr("text-anchor", "end")
    .attr("y", 6)
    .attr("dy", ".75em")
    .attr("transform", "rotate(-90)")
    .text("Poverty Data");

// Add the year label; the value is set on transition.
var label = svg.append("text")
    .attr("class", "year label")
    .attr("text-anchor", "end")
    .attr("y", height - 24)
    .attr("x", width)
    .text(1980);

// Add the country label; the value is set on transition.
var countrylabel = svg.append("text")
    .attr("class", "country label")
    .attr("text-anchor", "start")
    .attr("y", 80)
    .attr("x", 20)
    .text(" ");

var first_time = true;

// Load the data.
d3.json("http://localhost/Data.json", function(nations) {

  // A bisector since many nation's data is sparsely-defined.
  var bisect = d3.bisector(function(d) { return d[0]; });

  // Add a dot per nation. Initialize the data at 1980, and set the colors.
  var dot = svg.append("g")
      .attr("class", "dots")
    .selectAll(".dot")
      .data(interpolateData(1980))
    .enter().append("circle")
      .attr("class", "dot")
      .style("fill", function(d) { return colorScale(color(d)); })
      .call(position)
      .on("mousedow", function(d, i) {

      })
      .on("mouseup", function(d, i) {
        dot.classed("selected", false);
        d3.select(this).classed("selected", !d3.select(this).classed("selected"));
        dragit.trajectory.display(d, i, "selected");

        //TODO: test if has been dragged
        // Look at the state machine history and find a drag event in it?

      })
      .on("mouseenter", function(d, i) {
        clear_demo();
        if(dragit.statemachine.current_state == "idle") {
          dragit.trajectory.display(d, i)
          dragit.utils.animateTrajectory(dragit.trajectory.display(d, i), dragit.time.current, 1000)
          countrylabel.text(d.name);
          dot.style("opacity", .4)
          d3.select(this).style("opacity", 1)
          d3.selectAll(".selected").style("opacity", 1)
        }
      })
      .on("mouseleave", function(d, i) {

        if(dragit.statemachine.current_state == "idle") {
          countrylabel.text("");
          dot.style("opacity", 1);
        }
  
        dragit.trajectory.remove(d, i);
      })
      .call(dragit.object.activate)

  // Add a title.
  dot.append("title")
      .text(function(d) { return d.name; });

  // Start a transition that interpolates the data based on year.
  svg.transition()
      .duration(30000)
      .ease("linear")

  // Positions the dots based on data.
  function position(dot) {
    dot.attr("cx", function(d) { return xScale(x(d)); })
       .attr("cy", function(d) { return yScale(y(d)); })
       .attr("r", function(d) { return radiusScale(radius(d)); });
  }

  // Defines a sort order so that the smallest dots are drawn on top.
  function order(a, b) {
    return radius(b) - radius(a);
  }

  // Updates the display to show the specified year.
  function displayYear(year) {
    dot.data(interpolateData(year+dragit.time.min), key).call(position).sort(order);
    label.text(dragit.time.min + Math.round(year));
  }

  // Interpolates the dataset for the given (fractional) year.
  function interpolateData(year) {
    return nations.map(function(d) {
      // console.log(d);
      return {
        name: d.name,
        region: d.region,
        // income: interpolateValues(d.income, year),
        // population: interpolateValues(d.population, year),
        // lifeExpectancy: interpolateValues(d.lifeExpectancy, year)
        education: interpolateValues(d.education, year),
        health: interpolateValues(d.health, year),
        poverty: interpolateValues(d.poverty, year)        
      };
    });
  }

  // Finds (and possibly interpolates) the value for the specified year.
  function interpolateValues(values, year) {
    var i = bisect.left(values, year, 0, values.length - 1),
        a = values[i];
    if (i > 0) {
      var b = values[i - 1],
          t = (year - a[0]) / (b[0] - a[0]);
      return a[1] * (1 - t) + b[1] * t;
    }
    // console.log(a[1])
    return a[1];
  }
  
  init();

  function update(v, duration) {
    dragit.time.current = v || dragit.time.current;
    displayYear(dragit.time.current)
    d3.select("#slider-time").property("value", dragit.time.current);
  }

  function init() {

    dragit.init(".gRoot");

    dragit.time = {min:1980, max:2009, step:1, current:1980}
    dragit.data = d3.range(nations.length).map(function() { return Array(); })

    for(var yy = 1980; yy<2009; yy++) {

      interpolateData(yy).filter(function(d, i) { 
        dragit.data[i][yy-dragit.time.min] = [xScale(x(d)), yScale(y(d))];

      })
    }

    dragit.evt.register("update", update);

    //d3.select("#slider-time").property("value", dragit.time.current);

    d3.select("#slider-time")
      .on("mousemove", function() { 
        update(parseInt(this.value), 500);
        clear_demo();
      })

    var end_effect = function() {
      countrylabel.text("");
      dot.style("opacity", 1)
    }

    dragit.evt.register("dragend", end_effect)
  }

function clear_demo() {
  if(first_time) {
     svg.transition().duration(0);
    first_time = false;
    window.clearInterval(demo_interval);
    countrylabel.text("");
    dragit.trajectory.removeAll();
    d3.selectAll(".dot").style("opacity", 1)
  }
}

function play_demo() {

  var ex_nations = ["China", "India", "Indonesia", "Italy", "France", "Spain", "Germany", "United States"]
  var index_random_nation = null;
  var random_index = Math.floor(Math.random() * ex_nations.length);
  var random_nation = nations.filter(function(d, i) { 
    if(d.name == ex_nations[random_index]) {
      index_random_nation = i;
      return true;
    }
  })[0];

  var random_nation = nations[index_random_nation];

  dragit.trajectory.removeAll();
  dragit.trajectory.display(random_nation, index_random_nation);
  countrylabel.text(random_nation.name);

  dragit.utils.animateTrajectory(dragit.lineTrajectory, dragit.time.min, 2000)

  d3.selectAll(".dot").style("opacity", .4)

  d3.selectAll(".dot").filter(function(d) {
    return d.name == random_nation.name;
  }).style("opacity", 1)
}

var demo_interval = null;

setTimeout(function() {
  if(first_time) {
    play_demo()
    demo_interval = setInterval(play_demo, 3000)
  }
}, 1000);

});
}


</script>
<script src="distoUtils.js"></script>

</body>
</html>
